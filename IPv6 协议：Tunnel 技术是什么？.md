## IPv6 协议：Tunnel 技术是什么？

> IPv4 用 32 位整数描述地址，最多只能支持 43 亿设备，显然是不够用的，这也被称作 IP 地址耗尽问题。
>
> 为了解决这个问题，有一种可行的方法是**拆分子网**。拆分子网，会带来很多问题，比如说内外网数据交互，需要网络地址转换协议（NAT 协议），增加传输成本。再比如说，多级网络会增加数据的路由和传输链路，降低网络的速度。理想的状态当然是所有设备在一个网络中，互相可以通过地址访问。
>
> 为了解决这个问题，1998 年互联网工程工作小组推出了全新款的 IP 协议——IPv6 协议。但是目前 IPv6 的普及程度还不够高，2019 年据中国互联网络信息中心（CNNIC）统计，IPv6 协议目前在我国普及率为 60%，已经位居世界首位。
>
> 既然不能做到完全普及，也就引出了**本讲关联的一道面试题目：什么是 Tunnel 技术**？

### IPv4 和 IPv6 相似点

<p style="text-align:justify; text-indent:2em">IPv6 的工作原理和 IPv4 类似，分成切片（Segmentation）、增加封包头、路由（寻址）这样几个阶段去工作。IPv6 同样接收上方主机到主机（Host-to-Host）协议传递来的数据，比如一个 TCP 段（Segment），然后将 TCP 段再次切片做成一个个的 IPv6 封包（Datagram or Packet），再调用底层局域网能力（数据链路层）传输数据。

<p style="text-align:justify; text-indent:2em"><b>作为网络层协议的 IPv6，最核心的能力是确保数据可以从发送主机到达接收主机</b>。因此，和 IPv4 类似，IPv6同样需要定义地址的格式，以及路由算法如何工作。

### IPv6 地址

### IPv6 的寻址

#### 全局单播

#### 本地单播

#### 分组多播

#### 任意播（Anycast）

### IPv6 和 IPv4 的兼容